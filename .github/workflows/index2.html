<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profit Calculator — Clean & Responsive</title>
  <meta name="description" content="Profit calculator with currency support, shareable URLs, print & download results." />
  <style>
    :root{--bg:#f3f6fb;--card:#ffffff;--muted:#6b7280;--accent:#0ea5e9;--text:#0f172a;--success:#10b981;--danger:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:46px;height:46px;border-radius:10px;background:var(--accent);display:grid;place-items:center;color:#012; font-weight:800}
    .title{font-size:20px;font-weight:700}
    .subtitle{font-size:13px;color:var(--muted)}

    .grid{display:grid;gap:16px;margin-top:18px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 420px}}

    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    .field{margin-top:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=number], select{width:100%;padding:10px;border:1px solid #e6eef8;border-radius:8px;font-size:15px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent);color:#012}
    .btn.ghost{background:transparent;border:1px solid #dbeafe;color:var(--text)}
    .btn.warn{background:var(--danger);color:#fff}
    .note{font-size:13px;color:var(--muted);margin-top:10px}

    .resultBox{display:flex;flex-direction:column;gap:10px}
    .kv{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px}
    .kv .k{color:var(--muted)}
    .kv .v{font-weight:700}
    .positive{color:var(--success)}
    .negative{color:var(--danger)}

    .shareline{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:12px}
    .small{font-size:13px;color:var(--muted)}

    footer{margin-top:16px;text-align:center;color:var(--muted);font-size:13px}

    /* print styles */
    @media print{
      body *{visibility:hidden}
      #print-area, #print-area *{visibility:visible}
      #print-area{position:fixed;left:0;top:0;width:100%}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">PC</div>
        <div>
          <div class="title">Profit Calculator</div>
          <div class="subtitle">Calculate profit, margin, markup, break‑even. Shareable & printable.</div>
        </div>
      </div>
      <div class="small">Built for you — single file</div>
    </div>

    <div class="grid">
      <!-- Left: inputs -->
      <div class="card">
        <h3>Inputs</h3>
        <div class="row">
          <div class="field">
            <label for="sp">Selling price per unit</label>
            <input id="sp" type="number" step="0.01" min="0" placeholder="e.g. 25.00">
          </div>
          <div class="field">
            <label for="cp">Cost price per unit</label>
            <input id="cp" type="number" step="0.01" min="0" placeholder="e.g. 15.00">
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="qty">Quantity (units)</label>
            <input id="qty" type="number" step="1" min="0" placeholder="e.g. 100">
          </div>
          <div class="field">
            <label for="currency">Currency</label>
            <select id="currency">
              <option value="USD">USD — $</option>
              <option value="BDT">BDT — ৳</option>
              <option value="EUR">EUR — €</option>
              <option value="INR">INR — ₹</option>
              <option value="GBP">GBP — £</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="discount">Discount (%)</label>
            <input id="discount" type="number" step="0.1" min="0" max="100" placeholder="e.g. 10">
          </div>
          <div class="field">
            <label for="tax">Tax / VAT (%)</label>
            <input id="tax" type="number" step="0.1" min="0" placeholder="e.g. 5">
          </div>
        </div>

        <div class="field">
          <label for="overhead">Overheads (fixed cost)</label>
          <input id="overhead" type="number" step="0.01" min="0" placeholder="e.g. 200">
        </div>

        <div class="controls">
          <button class="btn primary" id="calcBtn">Calculate</button>
          <button class="btn ghost" id="resetBtn">Reset</button>
          <button class="btn ghost" id="printBtn">Print</button>
          <button class="btn ghost" id="downloadBtn">Download CSV</button>
          <button class="btn ghost" id="shareBtn">Share / Copy Link</button>
        </div>

        <div class="note">Note: Tax is considered an expense (applied on revenue). Discount reduces the selling price per unit.</div>
      </div>

      <!-- Right: results -->
      <div class="card" id="print-area">
        <h3>Results</h3>
        <div class="resultBox" id="results">
          <div class="kv"><div class="k">Effective price / unit</div><div class="v" id="out_eff">—</div></div>
          <div class="kv"><div class="k">Revenue</div><div class="v" id="out_rev">—</div></div>
          <div class="kv"><div class="k">Variable cost</div><div class="v" id="out_var">—</div></div>
          <div class="kv"><div class="k">Tax expense</div><div class="v" id="out_tax">—</div></div>
          <div class="kv"><div class="k">Overheads</div><div class="v" id="out_oh">—</div></div>
          <div class="kv"><div class="k">Total cost</div><div class="v" id="out_total">—</div></div>
          <div class="kv"><div class="k">Profit / (Loss)</div><div class="v" id="out_profit">—</div></div>
          <div class="kv"><div class="k">Profit per unit</div><div class="v" id="out_ppu">—</div></div>
          <div class="kv"><div class="k">Profit margin</div><div class="v" id="out_margin">—</div></div>
          <div class="kv"><div class="k">Markup on cost</div><div class="v" id="out_markup">—</div></div>
          <div class="kv"><div class="k">Contribution / unit</div><div class="v" id="out_contrib">—</div></div>
          <div class="kv"><div class="k">Break‑even units</div><div class="v" id="out_be">—</div></div>
        </div>

        <div class="shareline">
          <div class="small">Shareable URL updates when you calculate.</div>
          <div class="small" id="copyNotice" style="color:var(--success);"></div>
        </div>
      </div>
    </div>

    <footer>© <span id="year"></span> Profit Calculator — Open & simple</footer>
  </div>

  <script>
    // Helper utilities
    const $ = (id) => document.getElementById(id);
    const toNum = (v) => { const n = Number(v); return Number.isFinite(n) ? n : 0; };

    function formatMoney(amount, currency) {
      if (!Number.isFinite(amount)) amount = 0;
      try {
        return new Intl.NumberFormat(undefined, { style: 'currency', currency }).format(amount);
      } catch (e) {
        // fallback: simple symbol mapping
        const map = { USD: '$', BDT: '৳', EUR: '€', INR: '₹', GBP: '£' };
        const sym = map[currency] || currency + ' ';
        return sym + amount.toFixed(2);
      }
    }

    // Read URL params into inputs (if present)
    function loadFromURL() {
      const p = new URLSearchParams(location.search);
      if (p.has('sp')) $('sp').value = p.get('sp');
      if (p.has('cp')) $('cp').value = p.get('cp');
      if (p.has('qty')) $('qty').value = p.get('qty');
      if (p.has('disc')) $('discount').value = p.get('disc');
      if (p.has('tax')) $('tax').value = p.get('tax');
      if (p.has('oh')) $('overhead').value = p.get('oh');
      if (p.has('cur')) $('currency').value = p.get('cur');
    }

    // Write current inputs to URL for sharing
    function writeToURL() {
      const p = new URLSearchParams({
        sp: $('sp').value || 0,
        cp: $('cp').value || 0,
        qty: $('qty').value || 0,
        disc: $('discount').value || 0,
        tax: $('tax').value || 0,
        oh: $('overhead').value || 0,
        cur: $('currency').value || 'USD'
      });
      const url = location.pathname + '?' + p.toString();
      history.replaceState({}, '', url);
      return location.href;
    }

    // Core calculation logic (correct handling of discount & tax as expense)
    function calculate() {
      const sp = toNum($('sp').value);
      const cp = toNum($('cp').value);
      const qty = Math.max(0, Math.floor(toNum($('qty').value)));
      const disc = Math.min(100, Math.max(0, toNum($('discount').value)));
      const taxPct = Math.max(0, toNum($('tax').value));
      const oh = Math.max(0, toNum($('overhead').value));
      const cur = $('currency').value || 'USD';

      // Effective selling price after discount
      const effSp = sp * (1 - disc / 100);
      const revenue = effSp * qty; // revenue before tax
      const varCost = cp * qty;
      const taxExpense = revenue * (taxPct / 100); // tax paid (expense)
      const totalCost = varCost + oh + taxExpense;
      const profit = revenue - totalCost;
      const profitPerUnit = qty > 0 ? profit / qty : 0;
      const profitMargin = revenue > 0 ? (profit / revenue) * 100 : 0;
      const markup = cp > 0 ? ((effSp - cp) / cp) * 100 : 0;
      const contributionPerUnit = effSp - cp - (effSp * (taxPct / 100));
      const beUnits = contributionPerUnit > 0 ? Math.ceil(oh / contributionPerUnit) : Infinity;

      // Update UI
      $('out_eff').textContent = formatMoney(effSp, cur);
      $('out_rev').textContent = formatMoney(revenue, cur);
      $('out_var').textContent = formatMoney(varCost, cur);
      $('out_tax').textContent = formatMoney(taxExpense, cur);
      $('out_oh').textContent = formatMoney(oh, cur);
      $('out_total').textContent = formatMoney(totalCost, cur);

      const profitEl = $('out_profit');
      profitEl.textContent = formatMoney(profit, cur);
      profitEl.classList.remove('positive','negative');
      if (profit > 0) profitEl.classList.add('positive');
      else if (profit < 0) profitEl.classList.add('negative');

      $('out_ppu').textContent = formatMoney(profitPerUnit, cur);
      $('out_margin').textContent = profitMargin.toFixed(2) + '%';
      $('out_markup').textContent = markup.toFixed(2) + '%';
      $('out_contrib').textContent = formatMoney(contributionPerUnit, cur);
      $('out_be').textContent = Number.isFinite(beUnits) ? beUnits : 'Not possible';

      // update URL for sharing
      const url = writeToURL();
      return { sp, cp, qty, disc, taxPct, oh, cur, effSp, revenue, varCost, taxExpense, totalCost, profit, profitPerUnit, profitMargin, markup, contributionPerUnit, beUnits, url };
    }

    function resetAll() {
      ['sp','cp','qty','discount','tax','overhead'].forEach(id => $(id).value = '');
      $('currency').value = 'USD';
      // clear outputs
      ['out_eff','out_rev','out_var','out_tax','out_oh','out_total','out_profit','out_ppu','out_margin','out_markup','out_contrib','out_be'].forEach(id => $(id).textContent = '—');
      history.replaceState({}, '', location.pathname);
      $('copyNotice').textContent = '';
    }

    function printView() {
      window.print();
    }

    function downloadCSV(data) {
      const rows = [
        ['Field','Value'],
        ['Currency', data.cur],
        ['Selling price (per unit)', data.sp],
        ['Cost price (per unit)', data.cp],
        ['Quantity', data.qty],
        ['Discount %', data.disc],
        ['Tax %', data.taxPct],
        ['Overheads', data.oh],
        ['Effective SP', data.effSp],
        ['Revenue', data.revenue],
        ['Variable cost', data.varCost],
        ['Tax expense', data.taxExpense],
        ['Total cost', data.totalCost],
        ['Profit', data.profit],
        ['Profit per unit', data.profitPerUnit],
        ['Profit margin %', data.profitMargin],
        ['Markup %', data.markup],
        ['Contribution per unit', data.contributionPerUnit],
        ['Break-even units', data.beUnits]
      ];
      const csv = rows.map(r => r.map(c => '"' + String(c).replace(/"/g,'""') + '"').join(',')).join('');
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'profit-result.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(a.href);
    }

    function shareResult(data) {
      const txt = `Profit result:
Currency: ${data.cur}
Profit: ${formatMoney(data.profit, data.cur)}
Revenue: ${formatMoney(data.revenue, data.cur)}
Profit margin: ${data.profitMargin.toFixed(2)}%

Open: ${data.url}`;
      if (navigator.share) {
        navigator.share({ title: 'Profit calculation', text: txt, url: data.url }).catch(()=>{});
      } else if (navigator.clipboard) {
        navigator.clipboard.writeText(data.url).then(()=>{
          $('copyNotice').textContent = 'Link copied to clipboard!';
          setTimeout(()=>$('copyNotice').textContent = '', 2500);
        }).catch(()=> alert('Copy failed — here is the link:' + data.url));
      } else {
        prompt('Copy this link:', data.url);
      }
    }

    // Bind buttons
    document.addEventListener('DOMContentLoaded', () => {
      loadFromURL();
      $('year').textContent = new Date().getFullYear();

      $('calcBtn').addEventListener('click', ()=>{
        const data = calculate();
        // store last data for download/share
        window.__lastCalc = data;
      });

      $('resetBtn').addEventListener('click', ()=>{
        resetAll();
        window.__lastCalc = null;
      });

      $('printBtn').addEventListener('click', ()=>{
        if (!window.__lastCalc) calculate();
        printView();
      });

      $('downloadBtn').addEventListener('click', ()=>{
        const data = window.__lastCalc || calculate();
        downloadCSV(data);
      });

      $('shareBtn').addEventListener('click', ()=>{
        const data = window.__lastCalc || calculate();
        shareResult(data);
      });

      // Also allow Enter key in inputs to calculate
      ['sp','cp','qty','discount','tax','overhead','currency'].forEach(id => {
        $(id).addEventListener('keydown', (e)=>{ if (e.key === 'Enter') { e.preventDefault(); $('calcBtn').click(); } });
      });

      // If URL has params, calculate immediately
      const p = new URLSearchParams(location.search);
      if (p.toString()) { const data = calculate(); window.__lastCalc = data; }
    });
  </script>
</body>
</html>
